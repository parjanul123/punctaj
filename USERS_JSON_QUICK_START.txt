â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸš€ QUICK START - Users & Permissions JSON                  â•‘
â•‘                 Initiate and use the encrypted JSON system                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

QUICK SETUP (3 STEPS):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  Generate Encryption Key (First Time Only)
   
   Command: py SETUP_ENCRYPTION_KEY.py
   
   Creates: data/.encryption_key
   What: Fernet cipher key (AES-128)
   Security: 600 permissions (owner read/write only)


2ï¸âƒ£  Initialize users_permissions.json
   
   Command: py INIT_USERS_JSON.py
   
   Creates: data/users_permissions.json
   What: Downloads users from Supabase, saves locally encrypted
   Requires: supabase_config.ini with valid credentials


3ï¸âƒ£  Done! Start using in punctaj.exe
   
   The app automatically:
   â€¢ Loads users_permissions.json
   â€¢ Syncs with Supabase
   â€¢ Allows adding new users via dialog
   â€¢ Encrypts everything locally


FILES CREATED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After setup, you'll have:

d:\punctaj\data\
â”œâ”€ users_permissions.json (Encrypted JSON with users & permissions)
â”œâ”€ .encryption_key (Encryption key - 600 perms)
â”œâ”€ BlackWater/
â”‚  â””â”€ Politie.json
â””â”€ Saint_Denis/
   â””â”€ Politie.json


WHAT'S IN users_permissions.json:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "users": {
    "discord_id": {
      "discord_id": number,
      "username": "string",
      "is_admin": boolean,
      "permissions": { ... },
      "created_at": "ISO datetime",
      "updated_at": "ISO datetime"
    }
  },
  "last_sync": "ISO datetime",
  "sync_status": "cloud_downloaded|cloud_uploaded",
  "user_count": number,
  "version": 1
}

Example with 1 user:

{
  "users": {
    "123456789": {
      "discord_id": 123456789,
      "username": "john_doe#1234",
      "is_admin": false,
      "permissions": {
        "cities": {},
        "institutions": {},
        "employees": {},
        "cloud": {"upload": false, "download": false},
        "admin": {"view_logs": false, "manage_users": false, ...}
      },
      "created_at": "2026-02-06T20:30:00...",
      "updated_at": "2026-02-06T20:30:00..."
    }
  },
  "last_sync": "2026-02-06T20:30:00...",
  "sync_status": "cloud_downloaded",
  "user_count": 1,
  "version": 1
}


USAGE IN EXE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The system automatically:

1. On startup:
   âœ… Initializes USERS_PERMS_JSON_MANAGER
   âœ… Loads users_permissions.json
   âœ… Decrypts data with encryption key
   âœ… Ready to use

2. Admin wants to add user:
   âœ… Click menu: "Add User"
   âœ… Dialog appears
   âœ… Enter: Discord ID, Username, Admin checkbox
   âœ… Click: "Add User"
   âœ… System:
      â€¢ Adds to local JSON (encrypted)
      â€¢ Immediately syncs to Supabase
      â€¢ Shows success message

3. Other devices:
   âœ… On startup, sync downloads user from Supabase
   âœ… User appears in system
   âœ… Same permissions across all devices


ENCRYPTION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

How it works:

1. Encryption key (.encryption_key):
   â€¢ Generated once per device
   â€¢ Stored in data/ folder (600 permissions)
   â€¢ Unique to each installation
   â€¢ Used to encrypt/decrypt local data

2. Local data (users_permissions.json):
   â€¢ Encrypted with Fernet cipher (AES-128)
   â€¢ Even if file is copied, data is unreadable without key
   â€¢ Encrypted data starts with __encrypted__ prefix

3. Cloud data (Supabase):
   â€¢ Stored in discord_users table
   â€¢ granular_permissions column contains JSON
   â€¢ Also encrypted at rest by Supabase
   â€¢ HTTPS for transmission

4. Multi-device:
   â€¢ Device 1 has encryption key A
   â€¢ Device 2 has encryption key B
   â€¢ Each decrypts with own key
   â€¢ Cloud (Supabase) is source of truth


TROUBLESHOOTING:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Problem: "users_permissions.json not found"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution: Run py INIT_USERS_JSON.py


Problem: "Encryption key not found"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution: Run py SETUP_ENCRYPTION_KEY.py


Problem: "Cannot decrypt data"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
  1. Delete data/.encryption_key
  2. Run py SETUP_ENCRYPTION_KEY.py (generates new key)
  3. Run py INIT_USERS_JSON.py (re-download and re-encrypt)


Problem: "Supabase connection error"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
  1. Check supabase_config.ini exists
  2. Check URL and key are correct
  3. Check internet connection
  4. Run: py DIAGNOSE_SUPABASE.py


Problem: "Add user dialog not showing"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
  1. Check add_user_dialog.py exists
  2. Check USERS_PERMS_JSON_MANAGER initialized (check console)
  3. Check tkinter available (usually included)


MANUAL OPERATIONS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you need to manually work with the system:

# Python script operations:

from users_permissions_json_manager import UsersPermissionsJsonManager

manager = UsersPermissionsJsonManager(
    supabase_url="https://your-project.supabase.co",
    supabase_key="your_key",
    data_dir="data"
)

# Download from cloud
manager.download_from_cloud()

# Add new user and sync
manager.add_user_and_sync(123456789, "username#1234", is_admin=False)

# Upload changes
manager.upload_to_cloud()

# Full sync
manager.sync_bidirectional()

# Get stats
stats = manager.get_stats()
print(f"Total users: {stats['total_users']}")

# List users
users = manager.list_users()

# Get specific user permissions
perms = manager.get_user_permissions(123456789)


VERIFICATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After setup, run this to verify everything works:

py TEST_USERS_PERMISSIONS_JSON.py

This checks:
âœ… JSON file exists and valid
âœ… Encryption working
âœ… Connection to Supabase
âœ… User list loads
âœ… Permissions format correct
âœ… Sync operations work


NEXT:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Run setup scripts:
   py SETUP_ENCRYPTION_KEY.py
   py INIT_USERS_JSON.py

2. Verify:
   py TEST_USERS_PERMISSIONS_JSON.py

3. Run EXE:
   punctaj.exe

4. Try adding user from menu: "Add User"

5. Check file created:
   data/users_permissions.json âœ…
   data/.encryption_key âœ…


DONE! âœ…

Your users & permissions JSON system is ready!
